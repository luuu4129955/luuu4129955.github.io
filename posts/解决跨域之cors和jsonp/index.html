<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>è§£å†³è·¨åŸŸä¹‹CORSå’ŒJSONP - å¯å–œã®life</title><meta name="Description" content=""><meta property="og:title" content="è§£å†³è·¨åŸŸä¹‹CORSå’ŒJSONP" />
<meta property="og:description" content="1.åŒæºç­–ç•¥ 1.1æº â€‹window.originæˆ–location.originå¯ä»¥å¾—åˆ°å½“å‰æºã€‚ â€‹æº=åè®®&#43;åŸŸå&#43;ç«¯å£å·ã€‚ å¦‚æœ2ä¸ªURLçš„å" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://luuu4129955.github.io/posts/%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F%E4%B9%8Bcors%E5%92%8Cjsonp/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-09-14T15:28:19+08:00" />
<meta property="article:modified_time" content="2021-09-14T15:28:19+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="è§£å†³è·¨åŸŸä¹‹CORSå’ŒJSONP"/>
<meta name="twitter:description" content="1.åŒæºç­–ç•¥ 1.1æº â€‹window.originæˆ–location.originå¯ä»¥å¾—åˆ°å½“å‰æºã€‚ â€‹æº=åè®®&#43;åŸŸå&#43;ç«¯å£å·ã€‚ å¦‚æœ2ä¸ªURLçš„å"/>
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://luuu4129955.github.io/posts/%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F%E4%B9%8Bcors%E5%92%8Cjsonp/" /><link rel="prev" href="https://luuu4129955.github.io/posts/%E5%85%B3%E4%BA%8Ehttp/" /><link rel="next" href="https://luuu4129955.github.io/posts/cookie%E5%92%8Csession/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "è§£å†³è·¨åŸŸä¹‹CORSå’ŒJSONP",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/luuu4129955.github.io\/posts\/%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F%E4%B9%8Bcors%E5%92%8Cjsonp\/"
        },"genre": "posts","keywords": "å‰åç«¯åˆ†ç¦»","wordcount":  1616 ,
        "url": "https:\/\/luuu4129955.github.io\/posts\/%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F%E4%B9%8Bcors%E5%92%8Cjsonp\/","datePublished": "2021-09-14T15:28:19+08:00","dateModified": "2021-09-14T15:28:19+08:00","publisher": {
            "@type": "Organization",
            "name": "å¯å–œ"},"author": {
                "@type": "Person",
                "name": "å¯å–œ"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="å¯å–œã®life">ğŸ˜‰å¯å–œã®life</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> æ–‡ç«  </a><a class="menu-item" href="/tags/"> æ ‡ç­¾ </a><a class="menu-item" href="/categories/"> åˆ†ç±» </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="å¯å–œã®life">ğŸ˜‰å¯å–œã®life</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">æ–‡ç« </a><a class="menu-item" href="/tags/" title="">æ ‡ç­¾</a><a class="menu-item" href="/categories/" title="">åˆ†ç±»</a><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">ç›®å½•</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">è§£å†³è·¨åŸŸä¹‹CORSå’ŒJSONP</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>å¯å–œ</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2021-09-14">2021-09-14</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;çº¦ 1616 å­—&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;é¢„è®¡é˜…è¯» 4 åˆ†é’Ÿ&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>ç›®å½•</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#1åŒæºç­–ç•¥">1.åŒæºç­–ç•¥</a>
      <ul>
        <li><a href="#11æº">1.1æº</a></li>
        <li><a href="#12åŒæºç­–ç•¥">1.2åŒæºç­–ç•¥</a></li>
        <li><a href="#13é™åˆ¶èŒƒå›´">1.3é™åˆ¶èŒƒå›´</a></li>
      </ul>
    </li>
    <li><a href="#2è§£å†³è·¨åŸŸæ³•1cors">2.è§£å†³è·¨åŸŸæ³•1ï¼šCORS</a>
      <ul>
        <li><a href="#æ˜¯ä»€ä¹ˆ">æ˜¯ä»€ä¹ˆï¼Ÿ</a></li>
        <li><a href="#å¦‚ä½•åš">å¦‚ä½•åšï¼Ÿ</a></li>
      </ul>
    </li>
    <li><a href="#3è§£å†³è·¨åŸŸæ³•2jsonp">3.è§£å†³è·¨åŸŸæ³•2ï¼šJSONP</a>
      <ul>
        <li><a href="#æ€è·¯">æ€è·¯ï¼š</a></li>
        <li><a href="#å¦‚ä½•æŠŠæ•°æ®æ”¾åˆ°jsä¸­">å¦‚ä½•æŠŠæ•°æ®æ”¾åˆ°JSä¸­ï¼Ÿ</a></li>
        <li><a href="#ç¼ºç‚¹ä¸èƒ½æŒ‡å®šå…è®¸è®¿é—®çš„æº">ç¼ºç‚¹ï¼šä¸èƒ½æŒ‡å®šå…è®¸è®¿é—®çš„æºã€‚</a></li>
        <li><a href="#ä¼˜åŒ–æ€è·¯">ä¼˜åŒ–æ€è·¯</a></li>
        <li><a href="#å°è£…jsonp">å°è£…JSONP</a></li>
        <li><a href="#ä¼˜ç‚¹å…¼å®¹ieå¯ä»¥è·¨åŸŸ">ä¼˜ç‚¹ï¼šå…¼å®¹IE+å¯ä»¥è·¨åŸŸ</a></li>
        <li><a href="#ç¼ºç‚¹">ç¼ºç‚¹ï¼š</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="1åŒæºç­–ç•¥">1.åŒæºç­–ç•¥</h2>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="11æº">1.1æº</h3>
<ul>
<li>â€‹<code>window.origin</code>æˆ–<code>location.origin</code>å¯ä»¥å¾—åˆ°å½“å‰<strong>æº</strong>ã€‚</li>
<li>â€‹<code>æº=åè®®+åŸŸå+ç«¯å£å·</code>ã€‚</li>
<li>å¦‚æœ2ä¸ªURLçš„åè®®ã€åŸŸåå’Œç«¯å£å·éƒ½å®Œå…¨ä¸€è‡´ï¼Œé‚£ä¹ˆè¿™2ä¸ªURLå°±æ˜¯åŒæºçš„ã€‚</li>
</ul>
<p>ä¸¾ä¾‹ï¼š</p>
<pre tabindex="0"><code>https://www.baidu.com
//'https://'æ˜¯åè®®ï¼Œ'www.baidu.com'æ˜¯åŸŸåï¼Œé»˜è®¤80ç«¯å£å¯ä»¥çœç•¥
</code></pre><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="12åŒæºç­–ç•¥">1.2åŒæºç­–ç•¥</h3>
<p>1995å¹´ï¼ŒåŒæºç­–ç•¥ï¼ˆSOP/same origin policyï¼‰ç”± Netscape å…¬å¸å¼•å…¥æµè§ˆå™¨ã€‚ç›®å‰ï¼Œæ‰€æœ‰æµè§ˆå™¨éƒ½å®è¡Œè¿™ä¸ªæ”¿ç­–ã€‚<!-- raw HTML omitted -->åŒæºç­–ç•¥è§„å®šï¼šå¦‚æœJSè¿è¡Œåœ¨æºAé‡Œï¼Œé‚£ä¹ˆå°±åªèƒ½è·å–æºAçš„æ•°æ®ï¼Œä¸èƒ½è·å–æºBçš„æ•°æ®ï¼Œå³ä¸å…è®¸è·¨åŸŸè®¿é—®ã€‚<!-- raw HTML omitted --><strong>ç›®çš„ï¼šæ˜¯ä¸ºäº†ä¿è¯ç”¨æˆ·ä¿¡æ¯çš„å®‰å…¨ï¼Œé˜²æ­¢æ¶æ„çš„ç½‘ç«™çªƒå–æ•°æ®ã€‚</strong>
<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="13é™åˆ¶èŒƒå›´">1.3é™åˆ¶èŒƒå›´</h3>
<p>éšç€äº’è”ç½‘çš„å‘å±•ï¼Œ&ldquo;åŒæºæ”¿ç­–&quot;è¶Šæ¥è¶Šä¸¥æ ¼ã€‚ç›®å‰ï¼Œå¦‚æœéåŒæºï¼Œå…±æœ‰ä¸‰ç§è¡Œä¸ºå—åˆ°é™åˆ¶ã€‚</p>
<ul>
<li>Cookieã€LocalStorage å’Œ IndexDB æ— æ³•è¯»å–ã€‚</li>
<li>DOM æ— æ³•è·å¾—ã€‚</li>
<li>AJAX è¯·æ±‚ä¸èƒ½å‘é€ã€‚
<!-- raw HTML omitted --><!-- raw HTML omitted --></li>
</ul>
<h2 id="2è§£å†³è·¨åŸŸæ³•1cors">2.è§£å†³è·¨åŸŸæ³•1ï¼šCORS</h2>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="æ˜¯ä»€ä¹ˆ">æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>CORSæ˜¯ä¸€ä¸ªW3Cæ ‡å‡†ï¼Œå…¨ç§°æ˜¯&quot;è·¨åŸŸèµ„æºå…±äº«&rdquo;ï¼ˆCross-origin resource sharingï¼‰ã€‚æ˜¯ä¸€ç§åŸºäºHTTPå¤´çš„æœºåˆ¶ã€‚<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="å¦‚ä½•åš">å¦‚ä½•åšï¼Ÿ</h3>
<p>è‹¥æºAæƒ³è¦è®¿é—®æºBï¼Ÿ<!-- raw HTML omitted -->é‚£ä¹ˆå°±åœ¨æºBçš„å“åº”å¤´ä¸­å†™ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"> <span class="nx">response</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">,</span><span class="s1">&#39;http://XXX.com:9999&#39;</span><span class="p">)</span>
<span class="c1">//å³æºB å…è®¸ æºAçš„è®¿é—®
</span></code></pre></div><p>ç¼ºç‚¹ï¼š</p>
<ol>
<li>æµè§ˆå™¨ä¸èƒ½ä½äºIE10ï¼ˆä¸èƒ½å…¼å®¹IEï¼‰
<!-- raw HTML omitted --><!-- raw HTML omitted --></li>
</ol>
<h2 id="3è§£å†³è·¨åŸŸæ³•2jsonp">3.è§£å†³è·¨åŸŸæ³•2ï¼šJSONP</h2>
<p>æˆ‘ä»¬ä½¿ç”¨<code>script</code>æ ‡ç­¾è¯·æ±‚å¦ä¸€ä¸ªç½‘ç«™çš„<code>js</code>ï¼ˆè¿™ä¸ª<code>js</code>å¤¹å¸¦äº†ä¸€äº›æ•°æ®ï¼‰ï¼Œè¿™äº›æ•°æ®ä¼šåœ¨æœ¬åœ°è°ƒç”¨ä¸€ä¸ªå…¨å±€å‡½æ•°è¿è¡Œã€‚è¿™å°±æ˜¯<code>JSONP</code>çš„å®ç°ã€‚
<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="æ€è·¯">æ€è·¯ï¼š</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">è™½ç„¶æˆ‘ä»¬æ— æ³•è®¿é—®http</span><span class="o">:</span><span class="c1">//XXX.com:9999/xxx.json
</span><span class="c1"></span><span class="nx">ä½†æˆ‘ä»¬å¯ä»¥è®¿é—®http</span><span class="o">:</span><span class="c1">//XXX.com:9999/xxx.js
</span><span class="c1"></span>
<span class="nx">æ‰€ä»¥åªè¦æˆ‘ä»¬æŠŠæ•°æ®æ”¾åˆ°jsé‡Œ</span><span class="err">ï¼Œ</span><span class="nx">ç„¶åå†è®¿é—®åŒ…å«æ•°æ®çš„jså³å¯</span><span class="err">ã€‚</span>
</code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="å¦‚ä½•æŠŠæ•°æ®æ”¾åˆ°jsä¸­">å¦‚ä½•æŠŠæ•°æ®æ”¾åˆ°JSä¸­ï¼Ÿ</h3>
<p>ä¸¾ä¾‹ï¼šæºAè®¿é—®æºB<!-- raw HTML omitted -->æºAä¸­åšä¸¤ä»¶äº‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">//ç¬¬ä¸€æ­¥ï¼šæŒ‡å‘æºBçš„xxx.js
</span><span class="c1"></span><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&#34;http://XXX.com:9999/xxx.js&#34;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt; </span>
<span class="c1">//ç¬¬äºŒæ­¥ï¼šå†™ä¸€ä¸ªå›è°ƒå‡½æ•°æ¥æ¥æ”¶æ•°æ®ï¼ˆå‡½æ•°åå¯çº¦å®šï¼Œæˆ–é€šè¿‡åœ°å€å‚æ•°ä¼ é€’ï¼‰
</span><span class="c1"></span><span class="nb">window</span><span class="p">.</span><span class="nx">callback</span> <span class="o">=</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">//ä¸€èˆ¬åšæ³•ï¼šéœ€è¦æŠŠscriptæ ‡ç­¾åŠ¨æ€æ’å…¥åˆ°bodyä¸­ï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">script</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">)</span>
<span class="nx">script</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="s2">&#34;http://XXX.com:9999/xxx.js&#34;</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">)</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">callback</span> <span class="o">=</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><p>æºBï¼š<code>[http://XXX.com:9999/xxx.js](http://XXX.com:9999/xxx.js)</code>æ–‡ä»¶ä¸­å†™ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">//æºBæŠŠæ•°æ®åŒ…è£…ï¼Œå³ä¸ºJSONP
</span><span class="c1"></span><span class="nb">window</span><span class="p">.</span><span class="nx">callback</span><span class="p">({</span>
	<span class="s2">&#34;name&#34;</span><span class="o">:</span><span class="s2">&#34;lulu&#34;</span><span class="p">,</span>
  <span class="s2">&#34;gender&#34;</span><span class="o">:</span><span class="s2">&#34;Male&#34;</span>
<span class="p">})</span>
</code></pre></div><p>ä¸€æ—¦æºAè®¿é—®æºBï¼Œæµè§ˆå™¨å°±è°ƒç”¨callbackå‡½æ•°ï¼Œå¹¶ä¼ é€’è§£æåçš„JSONå¯¹è±¡ä½œä¸ºå›è°ƒå‡½æ•°çš„å‚æ•°ã€‚<!-- raw HTML omitted -->è¿™æ ·æºAå°±å¯ä»¥åœ¨å›è°ƒå‡½æ•°å¤„ç†ä¼ å…¥çš„æ•°æ®ã€‚<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="ç¼ºç‚¹ä¸èƒ½æŒ‡å®šå…è®¸è®¿é—®çš„æº">ç¼ºç‚¹ï¼šä¸èƒ½æŒ‡å®šå…è®¸è®¿é—®çš„æºã€‚</h3>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h4 id="è§£å†³åŠæ³•">è§£å†³åŠæ³•ï¼š</h4>
<p><strong>Referer</strong> è¯·æ±‚å¤´åŒ…å«äº†å½“å‰è¯·æ±‚é¡µé¢çš„æ¥æºé¡µé¢çš„åœ°å€ã€‚<!-- raw HTML omitted -->æºBçš„åå°ç”¨<code>referer</code>æ£€æŸ¥ä¸€ä¸‹è®¿é—®æº</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">//referer æ£€æŸ¥ä¸€ä¸‹è®¿é—®æºæ˜¯å¦ä¸ºæŒ‡å®šæº
</span><span class="c1">//å…ˆè·å¾—è®¿é—®æºï¼Œå†å­—ç¬¦ä¸²åŒ¹é…ä¸€ä¸‹
</span><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;referer&#39;</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;http://frank.com:9999&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">){</span>
    <span class="c1">// åšä¸Šè¿°JSONPçš„åç«¯å¤„ç†
</span><span class="c1"></span><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">404</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
<span class="p">}</span>

</code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="ä¼˜åŒ–æ€è·¯">ä¼˜åŒ–æ€è·¯</h3>
<p>æºAå’ŒæºBçš„å›è°ƒå‡½æ•°çš„å‡½æ•°åå¿…é¡»ä¸€è‡´ã€‚
<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h4 id="è‡ªåŠ¨ç”Ÿæˆå‡½æ•°å">è‡ªåŠ¨ç”Ÿæˆå‡½æ•°å</h4>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h4 id="å¦‚ä½•åš-1">å¦‚ä½•åšï¼Ÿ</h4>
<p>æºAä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">//random()å‡½æ•°ç”Ÿæˆéšæœºæ•° å¹¶ åŠ ä¸€ä¸ªç‰¹æ®Šçš„å­—ç¬¦ä¸²å‰ç¼€
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">random</span><span class="o">=</span><span class="s1">&#39;frankJSONPCallbackName&#39;</span><span class="o">+</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span>

<span class="nb">window</span><span class="p">[</span><span class="nx">random</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">script</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">)</span>

<span class="c1">//è®¿é—®æºBçš„æ—¶å€™æŠŠå›è°ƒå‡½æ•°åä½œä¸ºæŸ¥è¯¢å‚æ•°æ”¾è¿›å»
</span><span class="c1"></span><span class="nx">script</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="sb">`http://XXX.com:9999/xxx.js?callback=&amp;{random}`</span>

<span class="c1">//scriptæ ‡ç­¾åŠ è½½åä»é¡µé¢ç§»å‡ºï¼Œæ¸…ç†åƒåœ¾ï¼Œé¿å…æ¯å¼€ä¸€ä¸ªJSONPè¯·æ±‚é¡µé¢å°±å¤šä¸€ä¸ªscriptæ ‡ç­¾
</span><span class="c1"></span><span class="nx">script</span><span class="p">.</span><span class="nx">onload</span><span class="o">=</span><span class="p">()=&gt;{</span>
		<span class="nx">script</span><span class="p">.</span><span class="nx">remove</span><span class="p">()</span>
<span class="p">}</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">)</span>


</code></pre></div><p>æºB:<!-- raw HTML omitted --><code>[http://XXX.com:9999/xxx.js](http://XXX.com:9999/xxx.js)</code>ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">//unKnownä½œä¸ºå›è°ƒå‡½æ•°åçš„å ä½ç¬¦
</span><span class="c1">//dataä½œä¸ºJSONPæ•°æ®çš„å ä½ç¬¦
</span><span class="c1"></span><span class="nb">window</span><span class="p">[</span><span class="s1">&#39;{{unknown}}&#39;</span><span class="p">]({{</span><span class="nx">data</span><span class="p">}})</span>
</code></pre></div><p>åå°ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="k">if</span> <span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;referer&#39;</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;http://frank.com:9999&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">){</span>
    <span class="kr">const</span> <span class="nx">string</span><span class="o">=</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s2">&#34;xxx/xxx.js&#34;</span><span class="p">).</span><span class="nx">toString</span><span class="p">()</span>
    <span class="kr">const</span> <span class="nx">data</span><span class="o">=</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s2">&#34;xxx/xxx.json&#34;</span><span class="p">).</span><span class="nx">toString</span><span class="p">()</span>
    
    <span class="c1">//å…ˆæŠŠJSONæ•°æ®æ›¿æ¢åŸjsä¸­çš„dataï¼Œå†æŠŠæŸ¥è¯¢å‚æ•°æ›¿æ¢åŸjsçš„å‡½æ•°å
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">string2</span><span class="o">=</span><span class="nx">string</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;{{data}}&#39;</span><span class="p">,</span><span class="nx">data</span><span class="p">)</span>
    										<span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;{{unKnown}}&#39;</span><span class="p">,</span><span class="nx">query</span><span class="p">.</span><span class="nx">callback</span><span class="p">)</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">404</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
<span class="p">}</span>

</code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="å°è£…jsonp">å°è£…JSONP</h3>
<p>å°†æœ€ç»ˆä¼˜åŒ–å¥½çš„ä»£ç å°è£…ä¸€ä¸ªå¯ä»¥ç›´æ¥è°ƒç”¨çš„API</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">JSONP</span><span class="p">(</span><span class="nx">url</span><span class="p">){</span>
	<span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span><span class="nx">reject</span><span class="p">)=&gt;{</span>
    
  	<span class="kr">const</span> <span class="nx">random</span><span class="o">=</span><span class="s1">&#39;frankJSONPCallbackName&#39;</span><span class="o">+</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span>

    <span class="nb">window</span><span class="p">[</span><span class="nx">random</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">resolve</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="c1">//æˆåŠŸæ‰§è¡Œè°ƒç”¨resolve()
</span><span class="c1"></span>    <span class="p">}</span>

		<span class="kr">const</span> <span class="nx">script</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">)</span>
    <span class="nx">script</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="sb">`</span><span class="si">${</span><span class="nx">url</span><span class="si">}</span><span class="sb">?functionName=</span><span class="si">${</span><span class="nx">random</span><span class="si">}</span><span class="sb">`</span>
    
    <span class="nx">script</span><span class="p">.</span><span class="nx">onload</span><span class="o">=</span><span class="p">()=&gt;{</span>
			<span class="nx">script</span><span class="p">.</span><span class="nx">remove</span><span class="p">()</span>
		<span class="p">}</span>
		
    <span class="nx">script</span><span class="p">.</span><span class="nx">onError</span><span class="o">=</span><span class="p">()=&gt;{</span>
    	<span class="nx">reject</span><span class="p">()</span> <span class="c1">//å¤±è´¥è°ƒç”¨reject()
</span><span class="c1"></span>    <span class="p">}</span>
		<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">)</span>
    
  <span class="p">})</span>
<span class="p">}</span>
</code></pre></div><p>æ¥ä¸‹æ¥å°±å¯ä»¥ç›´æ¥ä¸€å¥è¯ç”¨JSONPè·¨åŸŸäº†ï¼</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">JSONP</span><span class="p">(</span><span class="s1">&#39;http://XXX.com:9999/xxx.js&#39;</span><span class="p">)</span>
	<span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="p">=&gt;{</span>
		<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="ä¼˜ç‚¹å…¼å®¹ieå¯ä»¥è·¨åŸŸ">ä¼˜ç‚¹ï¼šå…¼å®¹IE+å¯ä»¥è·¨åŸŸ</h3>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="ç¼ºç‚¹">ç¼ºç‚¹ï¼š</h3>
<ol>
<li>å¾—ä¸åˆ°è¯·æ±‚çš„å“åº”å¤´</li>
<li>ç”±äºæ˜¯<code>script</code>æ ‡ç­¾ï¼Œæ‰€ä»¥åªèƒ½å‘<code>GET</code>è¯·æ±‚ã€‚</li>
</ol>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>æ›´æ–°äº 2021-09-14</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/">å‰åç«¯åˆ†ç¦»</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">è¿”å›</a></span>&nbsp;|&nbsp;<span><a href="/">ä¸»é¡µ</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/%E5%85%B3%E4%BA%8Ehttp/" class="prev" rel="prev" title="å…³äºHTTP"><i class="fas fa-angle-left fa-fw"></i>å…³äºHTTP</a>
            <a href="/posts/cookie%E5%92%8Csession/" class="next" rel="next" title="ä¸ºä»€ä¹ˆä¼šæœ‰Cookieå’ŒSession">ä¸ºä»€ä¹ˆä¼šæœ‰Cookieå’ŒSession<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2021 - 2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">å¯å–œ</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="å›åˆ°é¡¶éƒ¨">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="æŸ¥çœ‹è¯„è®º">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"å¤åˆ¶åˆ°å‰ªè´´æ¿","maxShownLines":100},"comment":{}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
